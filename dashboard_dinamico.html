<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Din√°mico de Cobertura Spot (HTML/JS)</title>
    <style>
        /* --- ESTILOS CSS --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #e9ecef; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #003366; border-bottom: 2px solid #0066cc; padding-bottom: 10px; }
        h2 { text-align: center; color: #0066cc; font-size: 1.2em; margin-bottom: 20px; }
        .control-panel { margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; }
        label { font-weight: bold; color: #343a40; display: block; margin-bottom: 5px; }
        select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1em; }
        
        /* Estilos de la Tabla */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #e9ecef; padding: 12px; text-align: left; }
        th { background-color: #0066cc; color: white; }
        td:nth-child(2) { text-align: right; font-weight: bold; }
        
        /* Estilos de la Visualizaci√≥n de Barras (Utilidad) */
        .chart-container { margin-top: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .bar-wrapper { display: flex; align-items: flex-end; justify-content: space-around; height: 150px; margin-top: 40px; border-bottom: 2px solid #333; }
        .bar { width: 45%; max-width: 150px; background-color: #33C4FF; position: relative; transition: height 0.5s ease-out; }
        .bar-sin { background-color: #FF5733; }
        .bar-label { position: absolute; top: -20px; left: 0; right: 0; text-align: center; font-weight: bold; color: #333; }
        .bar-caption { position: absolute; bottom: -30px; width: 100%; text-align: center; font-weight: bold; }
        .bar-title { text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 1.1em; }

        /* Helpers */
        .note { text-align: center; font-size: 0.9em; color: #555; margin-top: 30px; }
    </style>
</head>
<body>

<div class="container">
    <h1>‚ö° Dashboard Din√°mico de Cobertura de Precios Spot MEM</h1>
    <h2>Tesis: Simulaci√≥n de Escenarios (Generador T√©rmico - Cap. IV.5)</h2>
    <hr>
    
    <div class="control-panel">
        <label for="escenario-select">Seleccione el Escenario de Simulaci√≥n:</label>
        <select id="escenario-select"></select>
    </div>

    <div id="chart-title" class="bar-title"></div>

    <div class="chart-container">
        <div class="bar-wrapper">
            <div id="bar-sin" class="bar bar-sin">
                <div id="value-sin" class="bar-label"></div>
            </div>
            <div class="bar-caption" style="left: 0;">Sin Cobertura</div>

            <div id="bar-con" class="bar">
                <div id="value-con" class="bar-label"></div>
            </div>
            <div class="bar-caption" style="left: 50%;">Con Cobertura</div>
        </div>
    </div>
    
    <div id="resultados-resumen">
        <h3>üìä Resumen de Resultados Detallado</h3>
        <table>
            <thead>
                <tr><th>M√©trica</th><th>Valor</th></tr>
            </thead>
            <tbody id="table-body">
                </tbody>
        </table>
    </div>

    <p class="note" id="base-params"></p>

</div>

<script>
    // --- L√ìGICA JAVASCRIPT ---

    // 1. DATOS Y CONSTANTES
    const Q_MWh = 7200; // Producci√≥n mensual (MWh)
    const CV_MWh = 110; // Costo Variable de Producci√≥n ($/MWh)
    const PF_MWh = 180; // Precio del Futuro Vendido ($/MWh)
    const Costos_Totales = Q_MWh * CV_MWh; // $792,000

    const scenarios = [
        { id: 'E1', name: '1. Ca√≠da de Precios por Renovables', P_spot: 130 },
        { id: 'E2', name: '2. Escalada por Crisis Gas√≠fera', P_spot: 220 },
        { id: 'E3', name: '3. Shock Macroecon√≥mico / Devaluaci√≥n', P_spot: 200 },
        { id: 'E4', name: '4. Alta Hidraulicidad', P_spot: 140 }
    ];

    // 2. FUNCI√ìN DE FORMATO
    const formatCurrency = (value) => {
        // Usar la funci√≥n Intl para formatear como moneda (formato de Argentina)
        return new Intl.NumberFormat('es-AR', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 0
        }).format(value).replace('US$', '$').replace(/\s/g, ''); // Limpiar el s√≠mbolo de moneda si es necesario
    };

    // 3. FUNCI√ìN PRINCIPAL DE C√ÅLCULO Y RENDERIZADO
    const updateDashboard = (selectedId) => {
        const scenario = scenarios.find(s => s.id === selectedId);
        if (!scenario) return;

        // --- C√ÅLCULOS ---
        const Ingreso_Spot_Sin_Cobertura = scenario.P_spot * Q_MWh;
        const Utilidad_Sin_Cobertura = Ingreso_Spot_Sin_Cobertura - Costos_Totales;
        
        const Ingreso_Cubierto = Q_MWh * PF_MWh; // Constante: 180 * 7200 = 1,296,000
        const Utilidad_Con_Cobertura = Ingreso_Cubierto - Costos_Totales; // Constante: 504,000
        
        const Ajuste_Futuros = (PF_MWh - scenario.P_spot) * Q_MWh;
        const Diferencia_Utilidad = Utilidad_Con_Cobertura - Utilidad_Sin_Cobertura;

        // --- RENDERIZADO DE LA TABLA ---
        const tableBody = document.getElementById('table-body');
        tableBody.innerHTML = ''; // Limpiar contenido anterior

        let ajusteText;
        let gananciaText;

        if (Ajuste_Futuros < 0) {
            ajusteText = "Pago del Generador en Futuros (Ajuste Negativo) ($)";
            gananciaText = "Costo de Oportunidad (Ingreso no percibido) ($)";
        } else {
            ajusteText = "Cobro del Generador en Futuros (Ajuste Positivo) ($)";
            gananciaText = "Ganancia Adicional por Cobertura ($)";
        }

        const metrics = [
            ['Precio Spot Promedio ($/MWh)', formatCurrency(scenario.P_spot)],
            ['Precio Futuro Pactado ($/MWh)', formatCurrency(PF_MWh)],
            ['Ingreso Total Sin Cobertura ($)', formatCurrency(Ingreso_Spot_Sin_Cobertura)],
            [ajusteText, formatCurrency(Ajuste_Futuros)],
            ['Utilidad Neta Sin Cobertura ($)', formatCurrency(Utilidad_Sin_Cobertura)],
            ['Utilidad Neta Con Cobertura ($)', formatCurrency(Utilidad_Con_Cobertura)],
            [gananciaText, formatCurrency(Math.abs(Diferencia_Utilidad))]
        ];

        metrics.forEach(([key, value]) => {
            const row = tableBody.insertRow();
            const cellKey = row.insertCell(0);
            const cellValue = row.insertCell(1);
            cellKey.textContent = key;
            cellValue.textContent = value;
            // Destacar Utilidad Con Cobertura
            if (key.includes("Utilidad Neta Con Cobertura")) {
                row.style.fontWeight = 'bold';
                row.style.backgroundColor = '#e6f7ff';
            }
        });

        // --- RENDERIZADO DEL GR√ÅFICO (Barras CSS) ---
        const maxUtilidad = Math.max(Utilidad_Sin_Cobertura, Utilidad_Con_Cobertura, Costos_Totales);
        
        // La altura de las barras se calcula en porcentaje del valor m√°ximo
        const heightSin = (Utilidad_Sin_Cobertura / maxUtilidad) * 100;
        const heightCon = (Utilidad_Con_Cobertura / maxUtilidad) * 100;

        document.getElementById('bar-sin').style.height = `${Math.max(10, heightSin)}%`; // M√≠nimo 10% para visibilidad
        document.getElementById('bar-con').style.height = `${Math.max(10, heightCon)}%`;
        
        document.getElementById('value-sin').textContent = formatCurrency(Utilidad_Sin_Cobertura);
        document.getElementById('value-con').textContent = formatCurrency(Utilidad_Con_Cobertura);

        // RENDERIZADO DEL T√çTULO DEL GR√ÅFICO
        document.getElementById('chart-title').textContent = 
            `üìâ Utilidad Neta: Spot ${formatCurrency(scenario.P_spot)}/MWh (${scenario.name})`;

    };

    // 4. INICIALIZACI√ìN DE LA P√ÅGINA
    document.addEventListener('DOMContentLoaded', () => {
        const select = document.getElementById('escenario-select');
        
        // 4.1. Llenar el Dropdown
        scenarios.forEach(s => {
            const option = document.createElement('option');
            option.value = s.id;
            option.textContent = `${s.id}: ${s.name} (Spot $${s.P_spot})`;
            select.appendChild(option);
        });

        // 4.2. Establecer Nota de Par√°metros Base
        document.getElementById('base-params').textContent = 
            `Par√°metros Base: Producci√≥n = ${formatCurrency(Q_MWh)} MWh, Costo Variable = ${formatCurrency(CV_MWh)}/MWh, Precio Futuro (Vendido) = ${formatCurrency(PF_MWh)}/MWh.`;

        // 4.3. Asignar Evento y Cargar Estado Inicial
        select.addEventListener('change', (e) => updateDashboard(e.target.value));
        updateDashboard(select.value); // Cargar E1 por defecto
    });

</script>

</body>
</html>